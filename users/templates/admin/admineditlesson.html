{% extends 'admin/dashboard.html' %}
{% load static%}
{% load bootstrap_icons %}
{% load embed_video_tags %}

{% block content%}
<style>
    #lesson:target{
        background-color: #dddcdc;
    }
</style>
    <div class="container-fluid border p-1 p-md-5 bg-white">
        <form method="post" >
            {% csrf_token %}
            <div class="md-form ml-5 mr-5">
                <label for="id_title">Titlu</label>
                {{ updateLessonForm.title }}
            </div>
            <div class="md-form ml-5 mr-5">
                <label for="id_content">Content</label>
                {{ updateLessonForm.content }}
            </div>
            <div class="md-form ml-5 mr-5">
                <label for="id_code_python">Cod Python</label>
                {{ updateLessonForm.code_python }}
            </div>
            <div class="md-form ml-5 mr-5">
                <label for="id_code_html">Cod HTML</label>
                {{ updateLessonForm.code_html }}
            </div>
            <div class="md-form ml-5 mr-5">
                <label for="id_code_css">Cod CSS</label>
                {{ updateLessonForm.code_css }}
            </div>
            <div class="md-form ml-5 mr-5">
                <label for="id_code_js">Cod JavaScript</label>
                {{ updateLessonForm.code_js }}
            </div>
            <div class="md-form ml-5 mr-5">
                <label for="id_video">Linkul Videoclipului</label>
                {{ updateLessonForm.video }}
            </div>
            <div class="md-form ml-5 mr-5">
                <label for="id_slug">Slug</label>
                {{ updateLessonForm.slug }}
            </div>
            <button type="submit"  class="btn btn-outline-primary rounded-pill">Update</button>
            <a type="button" href="#lesson" class="btn btn-outline-info rounded-pill">View</a>
        </form>
    </div>
    <h2 class="mt-3">Preview Lesson content </h2>
    <div class="container-fluid border mt-2 bg-white">
        <div class="pt-5 ml-1">
            <div class="mt-5">
                {% for lectie in lessons_content|dictsort:'id' %}
                
                    {% if lesson.id == lectie.id %}
                        {% if lectie.title == None and lectie.slug == None %}
                            <div class="m-2 border">
                                You must complete the field "Titlu" or "Slug" to show button code
                            </div>
                        {% elif lectie.code_python %}
                        <div class="m-2 border">
                            Copy this snippet to show button code in page <br>
                            <code>
                                &lt;a onclick="{{ lectie.slug }}();" style="color: blue;"&gt; <br>
                                &nbsp;&nbsp;&nbsp;&nbsp;Try code <br>
                                &nbsp;&nbsp;&nbsp;&nbsp;&lt;svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="i bi-chevron-double-rightb" viewBox="0 0 16 16" &gt; <br>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;path fill-rule="evenodd" d="M3.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L9.293 8 3.646 2.354a.5.5 0 0 1 0-.708z"/&gt;<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;path fill-rule="evenodd" d="M7.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L13.293 8 7.646 2.354a.5.5 0 0 1 0-.708z"/&gt;<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;&lt;/svg&gt;<br>
                                &lt;/a&gt;
                            </code>
                        </div>
                        
                        {% endif %}
                        <div id="lesson" class="border">
                            <h1 id="title"></h1>
                
                            <div id="content"></div>

                            <div id="button" class="p-3"></div>
                    
                            <div id="video" class="container justify-content-center" ></div>
                            <div id="{{lectie.slug}}" style="width: 100%;height: 100%;z-index: 5;position: sticky;top: 0;left: 0;transform: translateX(-100vw);">
                                
                            </div>
                        </div>
                        
                        <script>
                            let code = [
                                $("#id_code_python"),
                                $("#id_code_html"),
                                $("#id_code_css"),
                                $("#id_code_js"),
                            ]
                            function {{lectie.slug}}(){
                                $('#{{lectie.slug}}').css('transform', 'translateX(0)')
                                if ($("#id_code_python").val()){
                                    $("#{{lectie.slug}}").html(
                                    '<link rel="stylesheet" type="text/css" media="all" href="/static/python_interpretor/css/codemirror.css">' + 
                                    '<link rel="stylesheet" type="text/css" media="all" href="/static/python_interpretor/css/solarized.css">' +
                                    '<script src="/static/python_interpretor/js/skulpt.js"><\/script>'+
                                    '<script src="/static/python_interpretor/js/skulpt-stdlib.js"><\/script>'+
                                    '<script src="/static/python_interpretor/js/codemirrorepl.js"><\/script>'+
                                    '<script src="/static/python_interpretor/js/repl.js"><\/script>'+
                                    '<script src="/static/python_interpretor/js/python.js"><\/script>'+
                                    '<script src="/static/python_interpretor/js/editor.js"><\/script>'+
                                    '<script src="/static/python_interpretor/js/plugins.js"><\/script>'+

                                    `
                                    <div style="margin-top: 100px;">
                                        <textarea id="code">${$("#id_code_python").val()}</textarea>
                                        <button class="btn btn-primary" id="skulpt_run">{% bs_icon 'play' %} Run</button>  
                                        <button type="button" class="btn btn-danger" id="clearoutput"> {% bs_icon 'trash' %} clear</button> 
                                        <button type="button" class="btn btn-success" onclick="($('#{{ lectie.slug }}').css('transform', 'translateX(-100%)'),$('#{{ lectie.slug }}').empty())"> {% bs_icon 'x' %} close</button>
                                    </div>
                                    <div id="mycanvas" class="d-block mt-3 text-light" style="box-sizing: border-box ;background-color: black;">
                                        <pre class="pl-3" id="edoutput" style=" color: white;"></pre>
                                    </div>
                                    `
                                )
                                } else {
                                    $("#{{lectie.slug}}").html(
                                        "<span class='text-danger'>No code to show </span>"
                                    )
                                }
                            }
                            
                        </script>
                    {% else %}
                        {% if lectie.title %}
                            <h1>{{lectie.title}}</h1>
                        {% endif %}
                    
                        {% autoescape off %}{{ lectie.content }}{% endautoescape %} 
                        <div class="p-3 d-flex justify-content-end">
                            <a id="something" href="{% url 'staff:editlesson' id=lectie.id %}?#lesson" class="btn btn-primary">View</a>
                        </div>
                        {% if lectie.video %}
                            <div class="container text-center" >
                                {% video lectie.video '100% x 100%' %}        
                            </div>
                        {% endif %}
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
    <div style="position: fixed;right: 25px;bottom: 50px;z-index: 5;">
        <a href="{% url 'staff:category' %}" class="btn btn-primary rounded-pill">Dashboard</a> 
    </div> 
    
    <script>
        
        $(document).ready( function (){
          $("#title").html($("#id_title").val());
          $("#content").html($("#id_content").val());
          
          if ($("#id_video").val() !== ""){
              $("#id_video").html(`<video class="border w-100" src="${$("#id_video").val()}"></video>`);
          }
       
          $("#previewCodeBtn").on("click", function(){
            $("#previewCode").css("transform", "translateX(0)")
        })
            if ($("#content > a")){
                if ($("#id_title").val() === "" || $("#id_slug").val() === ""){
                    $("#content > a").css("color", "red")
                }
            }
        })

        $("#id_title").on("keyup", function (){
          $("#title").html($("#id_title").val())
        });
        $("#id_content").on("keyup", function (){
          $("#content").html($("#id_content").val())
        });
        
        $("#id_video").on("keyup", function (){
          $("#video").html(`<video class="border w-100" src="${$("#id_video").val()}"></video>`)
        });
        $.each(code, function (){
            $(this).on("keyup", function (){
                    if ($("#content > a")){
                        if ($("#id_title").val() === "" || $("#id_slug").val() === ""){
                            $("#content > a").css("color", "red")
                        }
                    }
            })
        })
</script>
      
{% endblock %}
